generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id        Int      @id @default(autoincrement())
  nome      String
  email     String   @unique
  senha     String
  tipo      String
  ativo     Boolean  @default(true)
  criadoEm  DateTime @default(now())
  
  parceiro  Parceiro?
}

model Parceiro {
  id              Int      @id @default(autoincrement())
  usuarioId       Int      @unique
  telefone        String?
  percentual      Float    @default(50.0)
  criadoEm        DateTime @default(now())
  
  usuario         Usuario     @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  pecas           Peca[]
  pagamentos      Pagamento[]
}

model Marca {
  id        Int      @id @default(autoincrement())
  nome      String   @unique
  ativo     Boolean  @default(true)
  criadoEm  DateTime @default(now())
  
  pecas     Peca[]
}

model Tamanho {
  id        Int      @id @default(autoincrement())
  nome      String   @unique
  ordem     Int      @default(0)
  ativo     Boolean  @default(true)
  criadoEm  DateTime @default(now())
  
  pecas     Peca[]
}

model TipoPeca {
  id        Int      @id @default(autoincrement())
  nome      String   @unique
  ativo     Boolean  @default(true)
  criadoEm  DateTime @default(now())
  
  pecas     Peca[]
}

model Peca {
  id              Int      @id @default(autoincrement())
  codigoEtiqueta  String   @unique
  nome            String
  dataEntrada     DateTime @default(now())
  valorCusto      Float
  valorVenda      Float
  status          String   @default("disponivel")
  fotos           String[]
  observacoes     String?
  
  parceiroId      Int
  marcaId         Int
  tamanhoId       Int
  tipoPecaId      Int
  
  parceiro        Parceiro  @relation(fields: [parceiroId], references: [id])
  marca           Marca     @relation(fields: [marcaId], references: [id])
  tamanho         Tamanho   @relation(fields: [tamanhoId], references: [id])
  tipoPeca        TipoPeca  @relation(fields: [tipoPecaId], references: [id])
  
  vendas          Venda[]
  sacolinhas      SacolinhaPeca[]
  
  criadoEm        DateTime @default(now())
  atualizadoEm    DateTime @updatedAt
}

model Cliente {
  id            Int      @id @default(autoincrement())
  nome          String
  email         String   @unique
  senha         String
  telefone      String?
  endereco      String?
  cep           String?
  cidade        String?
  estado        String?
  observacoes   String?
  tipo          String   @default("cliente")
  ativo         Boolean  @default(true)
  criadoEm      DateTime @default(now())
  atualizadoEm  DateTime @updatedAt
  
  compras       Venda[]      @relation("ClienteCompras")
  sacolinhas    Sacolinha[]
}

model Venda {
  id              Int      @id @default(autoincrement())
  dataVenda       DateTime @default(now())
  valorVendido    Float
  
  pecaId          Int
  peca            Peca     @relation(fields: [pecaId], references: [id])
  
  clienteId       Int?
  cliente         Cliente? @relation("ClienteCompras", fields: [clienteId], references: [id])
  
  pagamento       Pagamento?
  
  criadoEm        DateTime @default(now())
}

model Pagamento {
  id              Int      @id @default(autoincrement())
  vendaId         Int      @unique
  parceiroId      Int
  valorParceiro   Float
  percentual      Float
  pago            Boolean  @default(false)
  dataPagamento   DateTime?
  observacoes     String?
  
  venda           Venda    @relation(fields: [vendaId], references: [id])
  parceiro        Parceiro @relation(fields: [parceiroId], references: [id])
  
  criadoEm        DateTime @default(now())
  atualizadoEm    DateTime @updatedAt
}

model Sacolinha {
  id              Int      @id @default(autoincrement())
  clienteId       Int
  cliente         Cliente  @relation(fields: [clienteId], references: [id])
  status          String   @default("aguardando_envio")
  dataEnvio       DateTime?
  valorFrete      Float?
  codigoRastreio  String?
  observacoes     String?
  criadoEm        DateTime @default(now())
  atualizadoEm    DateTime @updatedAt
  
  pecas           SacolinhaPeca[]
}

model SacolinhaPeca {
  id            Int        @id @default(autoincrement())
  sacolinhaId   Int
  pecaId        Int
  sacolinha     Sacolinha  @relation(fields: [sacolinhaId], references: [id], onDelete: Cascade)
  peca          Peca       @relation(fields: [pecaId], references: [id])
  adicionadoEm  DateTime   @default(now())
  
  @@unique([sacolinhaId, pecaId])
}
